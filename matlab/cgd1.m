function [X,P,G] = cgd1(A,b,it) %#codegen
    d = size(A,2);
	X = zeros(d,it);
	P = zeros(d,it);
	G = zeros(d,it);
	x = zeros(d,1);
    p = zeros(d,1);
    g = zeros(d,1);
    %pscl = zeros(d,1);
    %xupdt = zeros(d,1);
    %pupdt = zeros(d,1);
    %ng = 0;
    %ngnew = 0;
    q = 0;
    eta = 0;
    gamma = 0;
	p(:) = A*x - b;
	g(:) = p;
    %ng(:) = g'*g;
	for i = 1:it
        q = p'*A*p;
        %pscl(:) = p*d;
        %q(:) = p'*A*pscl;		        
        %eta(:) = ng/q;
        %xupdt(:) = eta*pscl;
        %x(:) = x - xupdt;
        eta(:) = (g/q)'*g;
        x(:) = x - eta*p;
        g(:) = A*x - b;
        %ngnew(:) = g'*g;		
        %gamma(:) = ngnew / ng;
        %pupdt(:) = gamma*p;        
        %p(:) = g + pupdt;
        %ng(:) = ngnew;
        gamma(:) = (g/eta)'*(g/q);
        p(:) = g + gamma*p;
        %disp([i eta gamma q]);
		X(:,i) = x;
		P(:,i) = p;
		G(:,i) = g;
	end;
